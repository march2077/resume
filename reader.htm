<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web TXT æ™ºæ…§é–±è®€å™¨</title>
    <style>
        /* --- CSS è®Šæ•¸å®šç¾© (ä¸»é¡Œæ ¸å¿ƒ) --- */
        :root {
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-color: #1d1d1f;
            --highlight-bg: #fff3cd;
            --highlight-border: #ffc107;
            --accent-color: #0071e3;
            --secondary-text: #86868b;
            --border-color: #d2d2d7;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --font-family: "PingFang TC", "Microsoft JhengHei", "Heiti TC", sans-serif;
        }

        /* æš—é»‘æ¨¡å¼è®Šæ•¸ */
        [data-theme="dark"] {
            --bg-color: #1c1c1e;
            --card-bg: #2c2c2e;
            --text-color: #e5e5e7;
            --highlight-bg: #3a3a3c;
            --highlight-border: #0a84ff;
            --accent-color: #0a84ff;
            --secondary-text: #98989d;
            --border-color: #48484a;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* é¤Šçœ¼æ¨¡å¼è®Šæ•¸ */
        [data-theme="sepia"] {
            --bg-color: #f2eadd;
            --card-bg: #fbf0d9;
            --text-color: #5b4636;
            --highlight-bg: #e6dbbf;
            --highlight-border: #8c6b4a;
            --accent-color: #b07d46;
            --secondary-text: #8f7863;
            --border-color: #dccbb1;
            --shadow: 0 4px 12px rgba(91, 70, 54, 0.1);
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- é ‚éƒ¨å·¥å…·åˆ— --- */
        header {
            background-color: var(--card-bg);
            padding: 10px 20px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            z-index: 100;
        }

        h1 { margin: 0; font-size: 1.2rem; color: var(--accent-color); }

        .toolbar-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* --- è¨­å®šé¢æ¿ (å¯æ‘ºç–Š) --- */
        #settings-panel {
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 20px;
            display: none; /* é è¨­éš±è— */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        #settings-panel.show { display: grid; }

        .setting-item { display: flex; flex-direction: column; gap: 5px; }
        .setting-item label { font-size: 0.85rem; color: var(--secondary-text); font-weight: bold;}
        
        /* --- ä¸»è¦å…§å®¹å€ --- */
        main {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        #reader-container {
            width: 100%;
            max-width: 800px;
            background-color: var(--card-bg);
            padding: 40px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            min-height: 50vh;
            transition: all 0.3s;
        }

        /* --- æ–‡å­—æ®µè½æ¨£å¼ --- */
        p.text-segment {
            margin: 0 0 1em 0;
            line-height: 1.8;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        p.text-segment:hover {
            background-color: rgba(0,0,0,0.05);
        }
        p.active {
            background-color: var(--highlight-bg);
            box-shadow: inset 4px 0 0 var(--highlight-border);
            font-weight: bold;
        }

        /* --- åº•éƒ¨æ§åˆ¶åˆ— --- */
        footer {
            background-color: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            z-index: 100;
        }

        /* --- UI å…ƒä»¶æ¨£å¼ --- */
        button, select, input[type="file"] {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        button:hover { filter: brightness(0.95); }
        button.primary { background-color: var(--accent-color); color: white; border: none; }
        button.primary:hover { filter: brightness(1.1); }
        button.icon-btn { padding: 6px 10px; font-size: 1.1rem; }
        
        input[type="range"] {
            width: 100%;
            accent-color: var(--accent-color);
        }

        .status-toast {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .status-toast.show { opacity: 1; }

        /* æª”æ¡ˆè³‡è¨Šé¡¯ç¤º */
        #file-info { font-size: 0.8rem; color: var(--secondary-text); margin-right: 10px;}
        
        /* éš±è—åŸç”Ÿ file inputï¼Œæ”¹ç”¨æŒ‰éˆ•è§¸ç™¼ */
        #fileInput { display: none; }

        @media (max-width: 600px) {
            #reader-container { padding: 20px; }
            .toolbar-group { width: 100%; justify-content: space-between; }
        }
    </style>
</head>
<body>

<!-- é ‚éƒ¨å°èˆª -->
<header>
    <div class="toolbar-group">
        <h1>ğŸ“š TXT Reader</h1>
        <span id="file-info">æœªè¼‰å…¥æª”æ¡ˆ</span>
    </div>
    <div class="toolbar-group">
        <button onclick="document.getElementById('fileInput').click()">ğŸ“‚ é–‹å•Ÿæª”æ¡ˆ</button>
        <input type="file" id="fileInput" accept=".txt">
        <button class="icon-btn" onclick="toggleSettings()" title="è¨­å®š">âš™ï¸</button>
    </div>
</header>

<!-- è¨­å®šé¢æ¿ -->
<div id="settings-panel">
    <div class="setting-item">
        <label>ğŸ¨ ä¸»é¡Œæ¨¡å¼</label>
        <select id="themeSelect" onchange="changeTheme(this.value)">
            <option value="system">éš¨ç³»çµ±</option>
            <option value="light">â˜€ï¸ æ˜äº®æ¨¡å¼</option>
            <option value="sepia">ğŸ“œ é¤Šçœ¼æ¨¡å¼</option>
            <option value="dark">ğŸŒ‘ æš—é»‘æ¨¡å¼</option>
        </select>
    </div>
    
    <div class="setting-item">
        <label>ğŸ”  æª”æ¡ˆç·¨ç¢¼ (äº‚ç¢¼è«‹åˆ‡æ›)</label>
        <select id="encodingSelect" onchange="reloadFileWithEncoding()">
            <option value="utf-8">UTF-8 (é€šç”¨)</option>
            <option value="big5">Big5 (ç¹é«”ä¸­æ–‡)</option>
            <option value="gbk">GBK (ç°¡é«”ä¸­æ–‡)</option>
        </select>
    </div>

    <div class="setting-item">
        <label>ğŸ—£ï¸ æœ—è®€è²éŸ³</label>
        <select id="voiceSelect"><option>è¼‰å…¥ä¸­...</option></select>
    </div>

    <div class="setting-item">
        <label>ğŸ‡ èªé€Ÿ: <span id="rateValue">1.0</span>x</label>
        <input type="range" id="rateRange" min="0.5" max="2" step="0.1" value="1" oninput="updateRate(this.value)">
    </div>

    <div class="setting-item">
        <label>ğŸ” å­—é«”å¤§å°: <span id="sizeValue">18</span>px</label>
        <input type="range" id="sizeRange" min="12" max="36" step="1" value="18" oninput="updateFontSize(this.value)">
    </div>
</div>

<!-- ä¸»è¦é–±è®€å€ -->
<main>
    <div id="reader-container">
        <div style="text-align:center; color: var(--secondary-text); margin-top: 50px;">
            <p>ğŸ‘‹ æ­¡è¿ä½¿ç”¨</p>
            <p>è«‹é»æ“Šå³ä¸Šè§’ã€Œé–‹å•Ÿæª”æ¡ˆã€è¼‰å…¥ TXT å°èªª</p>
        </div>
    </div>
</main>

<!-- ç‹€æ…‹æç¤º -->
<div id="toast" class="status-toast">ç‹€æ…‹è¨Šæ¯</div>

<!-- åº•éƒ¨æ§åˆ¶ -->
<footer id="footerControls" style="display:none;">
    <button onclick="changePage(-1)">â® ä¸Šä¸€é </button>
    <span id="pageIndicator" style="font-size: 0.9rem; font-weight: bold;">0 / 0</span>
    <button onclick="changePage(1)">ä¸‹ä¸€é  â­</button>
    
    <div style="width: 20px;"></div> <!-- Spacer -->
    
    <button id="btnPlay" class="primary icon-btn" onclick="togglePlay()" title="æ’­æ”¾/æš«åœ">â–¶</button>
    <button class="icon-btn" onclick="stopReading()" title="åœæ­¢">â¹</button>
</footer>

<script>
    // --- ç‹€æ…‹ç®¡ç† ---
    const state = {
        file: null,          // ç•¶å‰æª”æ¡ˆç‰©ä»¶
        textSegments: [],    // åˆ‡å‰²å¾Œçš„æ–‡å­—é™£åˆ—
        currentPage: 1,      // ç•¶å‰é ç¢¼
        itemsPerPage: 50,    // æ¯é æ®µè½æ•¸
        isReading: false,    // æ˜¯å¦æ­£åœ¨æœ—è®€
        isPaused: false,     // æ˜¯å¦æš«åœä¸­
        readingIndex: -1,    // å…¨åŸŸæœ—è®€ç´¢å¼•
        voices: [],          // èªéŸ³åˆ—è¡¨
        
        // ä½¿ç”¨è€…åå¥½ (æœƒå­˜å…¥ localStorage)
        prefs: {
            theme: 'system',
            encoding: 'utf-8',
            voiceName: '',
            rate: 1.0,
            fontSize: 18
        }
    };

    const synth = window.speechSynthesis;
    let currentUtterance = null;

    // --- åˆå§‹åŒ– ---
    window.onload = function() {
        loadPreferences();
        applyPreferences();
        populateVoices();
        
        // ç›£è½ç³»çµ±ä¸»é¡Œè®ŠåŒ–
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            if(state.prefs.theme === 'system') applyTheme('system');
        });
    };

    // --- æª”æ¡ˆè™•ç† ---
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        state.file = file;
        document.getElementById('file-info').textContent = file.name;
        readFile(file);
    });

    function readFile(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            processText(e.target.result);
            checkReadProgress(file.name, file.size); // æª¢æŸ¥æ˜¯å¦æœ‰é–±è®€ç´€éŒ„
        };
        reader.onerror = () => showToast("æª”æ¡ˆè®€å–å¤±æ•—");
        reader.readAsText(file, state.prefs.encoding);
    }

    function reloadFileWithEncoding() {
        if (!state.file) return;
        state.prefs.encoding = document.getElementById('encodingSelect').value;
        savePreferences();
        readFile(state.file);
        showToast(`å·²åˆ‡æ›ç·¨ç¢¼ç‚º: ${state.prefs.encoding}`);
    }

    function processText(text) {
        // åˆ‡å‰²æ–‡å­—ï¼Œä¿ç•™éç©ºè¡Œ
        state.textSegments = text.split(/\r\n|\n/).filter(line => line.trim() !== '');
        
        if (state.textSegments.length === 0) {
            showToast("æª”æ¡ˆå…§å®¹ç‚ºç©º");
            return;
        }

        // é‡ç½®ç‹€æ…‹
        state.currentPage = 1;
        state.readingIndex = -1;
        stopReading();
        
        document.getElementById('footerControls').style.display = 'flex';
        renderPage();
        showToast(`è¼‰å…¥æˆåŠŸï¼Œå…± ${state.textSegments.length} æ®µ`);
    }

    // --- æ¸²æŸ“èˆ‡åˆ†é  ---
    function renderPage() {
        const container = document.getElementById('reader-container');
        container.innerHTML = ''; // æ¸…ç©º
        
        const startIdx = (state.currentPage - 1) * state.itemsPerPage;
        const endIdx = Math.min(startIdx + state.itemsPerPage, state.textSegments.length);

        for (let i = startIdx; i < endIdx; i++) {
            const p = document.createElement('p');
            p.className = 'text-segment';
            p.textContent = state.textSegments[i];
            p.onclick = () => playSegment(i);
            
            // æ¢å¾©é«˜äº®
            if (i === state.readingIndex) {
                p.classList.add('active');
            }
            container.appendChild(p);
        }
        
        // æ›´æ–°é ç¢¼é¡¯ç¤º
        const totalPages = Math.ceil(state.textSegments.length / state.itemsPerPage);
        document.getElementById('pageIndicator').textContent = `${state.currentPage} / ${totalPages}`;
        
        // é é¢æ»¾å‹•åˆ°é ‚éƒ¨
        document.querySelector('main').scrollTop = 0;
    }

    function changePage(delta) {
        const totalPages = Math.ceil(state.textSegments.length / state.itemsPerPage);
        const newPage = state.currentPage + delta;
        if (newPage >= 1 && newPage <= totalPages) {
            state.currentPage = newPage;
            renderPage();
        }
    }

    // --- èªéŸ³æœ—è®€æ ¸å¿ƒ ---
    function populateVoices() {
        state.voices = synth.getVoices();
        const select = document.getElementById('voiceSelect');
        select.innerHTML = '';
        
        // æ’åºï¼šä¸­æ–‡å„ªå…ˆ
        state.voices.sort((a, b) => {
            const zhA = a.lang.includes('zh') ? 1 : 0;
            const zhB = b.lang.includes('zh') ? 1 : 0;
            return zhB - zhA;
        });

        state.voices.forEach(v => {
            const opt = document.createElement('option');
            opt.textContent = `${v.name} (${v.lang})`;
            opt.value = v.name;
            select.appendChild(opt);
        });

        // é¸ä¸­å„²å­˜çš„èªéŸ³
        if(state.prefs.voiceName) {
            select.value = state.prefs.voiceName;
        } else {
            // é è¨­é¸å–ç¬¬ä¸€å€‹ä¸­æ–‡
            const defaultZh = state.voices.find(v => v.lang.includes('zh-TW')) || state.voices.find(v => v.lang.includes('zh'));
            if(defaultZh) select.value = defaultZh.name;
        }
        
        // ç¶å®šè®Šæ›´äº‹ä»¶
        select.onchange = (e) => {
            state.prefs.voiceName = e.target.value;
            savePreferences();
        };
    }
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoices;
    }

    function togglePlay() {
        if (state.isReading && !state.isPaused) {
            // æš«åœ
            synth.pause();
            state.isPaused = true;
            updatePlayBtnIcon('â¸'); // é¡¯ç¤ºç¹¼çºŒ
            showToast("å·²æš«åœ");
        } else if (state.isReading && state.isPaused) {
            // ç¹¼çºŒ
            synth.resume();
            state.isPaused = false;
            updatePlayBtnIcon('â–¶'); // é¡¯ç¤ºæ’­æ”¾ä¸­(å…¶å¯¦æš«åœæŒ‰éˆ•æ‡‰è©²æ˜¯ ||)
            // ä¿®æ­£ï¼šé€™è£¡é‚è¼¯æ˜¯ "æŒ‰éˆ•é¡¯ç¤ºç¾åœ¨ç‹€æ…‹" é‚„æ˜¯ "æŒ‰éˆ•é¡¯ç¤ºå‹•ä½œ"ï¼Ÿ
            // é€šå¸¸ï¼šæ’­æ”¾ä¸­é¡¯ç¤ºã€Œæš«åœéˆ•ã€ï¼Œæš«åœä¸­é¡¯ç¤ºã€Œæ’­æ”¾éˆ•ã€ã€‚
            updatePlayBtnIcon('â¸'); 
        } else {
            // å¾é ­æˆ–ç•¶å‰é é–‹å§‹
            const startIdx = (state.currentPage - 1) * state.itemsPerPage;
            playSegment(startIdx);
        }
    }

    function updatePlayBtnIcon(icon) {
        // ç°¡å–®åˆ‡æ›ï¼Œå¯¦ä½œä¸Šï¼š
        // æ’­æ”¾ä¸­ -> æŒ‰éˆ•é¡¯ç¤º || (Pause)
        // æš«åœä¸­/åœæ­¢ -> æŒ‰éˆ•é¡¯ç¤º â–¶ (Play)
        const btn = document.getElementById('btnPlay');
        if (state.isReading && !state.isPaused) {
             btn.textContent = 'â¸'; 
             btn.title = "æš«åœ";
        } else {
             btn.textContent = 'â–¶';
             btn.title = "æ’­æ”¾";
        }
    }

    function playSegment(index) {
        synth.cancel();
        
        if (index >= state.textSegments.length) {
            stopReading();
            showToast("æœ—è®€çµæŸ");
            return;
        }

        // è‡ªå‹•ç¿»é é‚è¼¯
        const pageOfSegment = Math.floor(index / state.itemsPerPage) + 1;
        if (pageOfSegment !== state.currentPage) {
            state.currentPage = pageOfSegment;
            renderPage();
        }

        state.readingIndex = index;
        highlightActive();
        saveReadProgress(); // å„²å­˜é€²åº¦

        const text = state.textSegments[index];
        const utterance = new SpeechSynthesisUtterance(text);
        
        // è¨­å®šèªéŸ³åƒæ•¸
        const voiceName = document.getElementById('voiceSelect').value;
        const voice = state.voices.find(v => v.name === voiceName);
        if (voice) utterance.voice = voice;
        utterance.rate = state.prefs.rate;

        utterance.onend = () => {
            if (state.isReading) {
                playSegment(index + 1);
            }
        };
        
        utterance.onerror = (e) => {
            console.error(e);
            if (state.isReading) setTimeout(() => playSegment(index + 1), 200);
        };

        state.isReading = true;
        state.isPaused = false;
        updatePlayBtnIcon();
        synth.speak(utterance);
    }

    function stopReading() {
        state.isReading = false;
        state.isPaused = false;
        synth.cancel();
        updatePlayBtnIcon();
        // ç§»é™¤é«˜äº®ä½†ä¸é‡ç½® indexï¼Œæ–¹ä¾¿ä½¿ç”¨è€…çŸ¥é“è®€åˆ°å“ª
        // document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
    }

    function highlightActive() {
        // ç§»é™¤èˆŠé«˜äº®
        document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
        
        // è¨ˆç®—ç•¶å‰é é¢å…§çš„ç›¸å°ç´¢å¼•
        const startIdx = (state.currentPage - 1) * state.itemsPerPage;
        const localIdx = state.readingIndex - startIdx;
        
        const paragraphs = document.querySelectorAll('#reader-container p');
        if (paragraphs[localIdx]) {
            paragraphs[localIdx].classList.add('active');
            paragraphs[localIdx].scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    // --- åå¥½è¨­å®šèˆ‡ä»‹é¢æ“ä½œ ---
    function toggleSettings() {
        const panel = document.getElementById('settings-panel');
        panel.classList.toggle('show');
    }

    function changeTheme(theme) {
        state.prefs.theme = theme;
        applyTheme(theme);
        savePreferences();
    }

    function applyTheme(theme) {
        const body = document.body;
        body.removeAttribute('data-theme');
        
        if (theme === 'system') {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                body.setAttribute('data-theme', 'dark');
            }
        } else {
            body.setAttribute('data-theme', theme);
        }
        
        // åŒæ­¥é¸å–®
        document.getElementById('themeSelect').value = theme;
    }

    function updateFontSize(val) {
        state.prefs.fontSize = val;
        document.getElementById('sizeValue').textContent = val;
        document.getElementById('reader-container').style.fontSize = val + 'px';
        savePreferences();
    }

    function updateRate(val) {
        state.prefs.rate = val;
        document.getElementById('rateValue').textContent = val;
        savePreferences();
        // å¦‚æœæ­£åœ¨è®€ï¼Œéœ€è¦é‡å•Ÿæ‰èƒ½ç”Ÿæ•ˆï¼ˆWebSpeech API é™åˆ¶ï¼‰ï¼Œé€™è£¡ç°¡å–®è™•ç†ï¼š
        if(state.isReading) {
            playSegment(state.readingIndex);
        }
    }

    // --- LocalStorage è¨˜æ†¶åŠŸèƒ½ ---
    function savePreferences() {
        localStorage.setItem('reader_prefs', JSON.stringify(state.prefs));
    }

    function loadPreferences() {
        const saved = localStorage.getItem('reader_prefs');
        if (saved) {
            const p = JSON.parse(saved);
            state.prefs = { ...state.prefs, ...p };
        }
    }

    function applyPreferences() {
        // æ‡‰ç”¨ä¸»é¡Œ
        applyTheme(state.prefs.theme);
        // æ‡‰ç”¨ç·¨ç¢¼
        document.getElementById('encodingSelect').value = state.prefs.encoding;
        // æ‡‰ç”¨å­—é«”
        document.getElementById('sizeRange').value = state.prefs.fontSize;
        updateFontSize(state.prefs.fontSize);
        // æ‡‰ç”¨èªé€Ÿ
        document.getElementById('rateRange').value = state.prefs.rate;
        document.getElementById('rateValue').textContent = state.prefs.rate;
    }

    // é–±è®€é€²åº¦ (Key: æª”å+æª”æ¡ˆå¤§å°)
    function getFileKey(name, size) {
        return `progress_${name}_${size}`;
    }

    function saveReadProgress() {
        if (!state.file) return;
        const key = getFileKey(state.file.name, state.file.size);
        const data = {
            page: state.currentPage,
            index: state.readingIndex,
            timestamp: new Date().getTime()
        };
        localStorage.setItem(key, JSON.stringify(data));
    }

    function checkReadProgress(name, size) {
        const key = getFileKey(name, size);
        const saved = localStorage.getItem(key);
        if (saved) {
            const data = JSON.parse(saved);
            // é¡¯ç¤ºç°¡å–®çš„ Confirm (æˆ– Toast å¸¶æŒ‰éˆ•)
            if (confirm(`ç™¼ç¾ä¸Šæ¬¡é–±è®€ç´€éŒ„ (ç¬¬ ${data.page} é )ï¼Œæ˜¯å¦è·³è½‰ï¼Ÿ`)) {
                state.currentPage = data.page;
                renderPage();
                // ç¨å¾®å»¶é²ä»¥ç¢ºä¿ DOM æ¸²æŸ“å®Œç•¢
                setTimeout(() => {
                    state.readingIndex = data.index;
                    highlightActive();
                }, 100);
            }
        }
    }

    // --- è¼”åŠ© UI ---
    function showToast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

// --- éµç›¤å¿«é€Ÿéµæ”¯æ´ (PC é«”é©—æœ€ä½³åŒ–) ---
    document.addEventListener('keydown', function(e) {
        // å¦‚æœæ­£åœ¨è¨­å®šé¢æ¿è£¡æ‰“å­—ï¼Œä¸è¦è§¸ç™¼
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;

        switch(e.code) {
            case 'Space':
                e.preventDefault(); // é˜²æ­¢ç¶²é æ²å‹•
                togglePlay();
                break;
            case 'ArrowRight':
                e.preventDefault();
                changePage(1);
                break;
            case 'ArrowLeft':
                e.preventDefault();
                changePage(-1);
                break;
            // é¡å¤–è´ˆé€ï¼šä¸Šä¸‹éµå¯ä»¥èª¿æ•´éŸ³é‡æˆ–èªé€Ÿï¼Œé€™è£¡å…ˆä¿ç•™çµ¦æ®µè½è·³è½‰
            case 'ArrowDown':
                e.preventDefault();
                if(state.isReading) playSegment(state.readingIndex + 1);
                break;
            case 'ArrowUp':
                e.preventDefault();
                if(state.isReading && state.readingIndex > 0) playSegment(state.readingIndex - 1);
                break;
        }
    });
</script>

</body>
</html>